<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>game 1 brick </title>
    <style>
        canvas {
            border: 1px solid gray;
        }
    </style>
</head>
<body>
    <div>
        <canvas id="id-canvas" width="400" height="300"></canvas>
        <br/>
        <input id='id-input-speed' type="range" >

    </div>
    <script src="guagame.js"></script>
    <script src="paddle.js"></script>
    <script src="ball.js"></script>
    <script src="block.js"></script>
    <script src="utils.js"></script>
    <script src="level.js"></script>
    <script>
        var blocks = []
        var paused = false
        var __mian = function () {
            var enableDebugMode = function(enable) {
            if (!enable) {
                return
            }
            window.addEventListener('keydown', function(event) {
                let k = event.key
                if (k === 'p') {
                    paused = !paused 
                } else if ('123456'.includes(k)) {
                    console.log(k)
                    blocks = loadLevel(Number(k))
                }
            })
            // 控制speed
            document.querySelector('#id-input-speed').addEventListener('input', function(event) {
                var fps = event.target.value
                window.fps = fps
            })
        }

        var loadLevel = function(n) {
            n = n - 1
            var level = levels[n]
            var blocks = []
            for (var i = 0; i < level.length; i++) {
                var p = level[i]
                var b = Block(p)
                blocks.push(b)
            }
            return blocks
        }


            enableDebugMode(true)
            // 封装 game
            var game = Guagame(20)
            // 封装  paddle
            var paddle = Paddle()
            var ball = Ball()
            // var block = Block()
            blocks = loadLevel(1)

            // register actions
            game.registerAction('a', function () {
                paddle.moveLeft()
            })
            game.registerAction('d', function () {
                paddle.moveRight()
            })
            game.registerAction('f', function () {
                ball.fire()
            })

            game.update = function () {
                if (paused) {
                    return
                }
                ball.move()
                // 判断相撞
                if (paddle.collide(ball)) {
                    ball.反弹()
                }
                for (var i = 0; i < blocks.length; i++) {
                    var block = blocks[i]
                    if (block.collide(ball)) {
                        block.kill()
                        ball.反弹()
                    }
                }
        
                
            }
            game.draw = function () {
                game.drawImage(paddle)
                game.drawImage(ball)
                
                for (var i = 0; i < blocks.length; i++) {
                    var block = blocks[i]
                    if (block.alive) {
                        game.drawImage(block)   
                    }  
                }
                           
            }



        }

        __mian()

    </script>

    <script>
        /*
        * 优化：
        * 1.封装 Paddle
        * 2.封装 setInterval、canvas
        * 3.分装按键事件
        * 4.封装 ball
          5.判断矩形相撞
          6.添加 block
          ***todo: 抽 paddle.move 方法非常精妙 第二节31：15

          7.再次抽离框架函数guagame.js第二节 55：00
          8.添加关卡 1：03：38
          9.给砖块加命 1：15：28
          10.全局fps抽离 1：24：43
          11.添加滑条 1：31：47
        * */
    </script>

</body>
</html>
